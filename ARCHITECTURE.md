## HSDC System Architecture & File Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          HSDC Security System                                â”‚
â”‚                         Next.js 14 App Router                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CLIENT LAYER (React Components - Browser)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ app/upload/page.tsx  â”‚  â”‚app/recovery/page.tsx â”‚  â”‚app/dashboard/    â”‚  â”‚
â”‚  â”‚                      â”‚  â”‚                      â”‚  â”‚page.tsx          â”‚  â”‚
â”‚  â”‚ âœ… Upload Form       â”‚  â”‚ âœ… Recovery Form     â”‚  â”‚ âœ… Stats View    â”‚  â”‚
â”‚  â”‚ âœ… File Validation   â”‚  â”‚ âœ… File Selection    â”‚  â”‚ âœ… Recent Files  â”‚  â”‚
â”‚  â”‚ âœ… Progress UI       â”‚  â”‚ âœ… Progress UI       â”‚  â”‚ âœ… Activity Log  â”‚  â”‚
â”‚  â”‚ âœ… Error Handling    â”‚  â”‚ âœ… Tamper Detection  â”‚  â”‚                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚app/admin/        â”‚  â”‚components/                 â”‚  â”‚components/ui/ â”‚  â”‚
â”‚  â”‚page.tsx          â”‚  â”‚file-uploader.tsx           â”‚  â”‚               â”‚  â”‚
â”‚  â”‚                  â”‚  â”‚progress-indicator.tsx      â”‚  â”‚âœ… 30+ Shadcn  â”‚  â”‚
â”‚  â”‚âœ… RBAC Check     â”‚  â”‚dashboard-shell.tsx         â”‚  â”‚   UI Comps    â”‚  â”‚
â”‚  â”‚âœ… Admin View     â”‚  â”‚theme-provider.tsx          â”‚  â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                               â”‚
â”‚  â””â”€ No client-side encryption                                                â”‚
â”‚  â””â”€ All crypto happens server-side                                           â”‚
â”‚  â””â”€ Browser handles UI only                                                  â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Next.js Server Actions (RPC)  â”‚
                    â”‚ (Encrypted channel)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SERVER ACTIONS LAYER (Next.js RPC - Secure)                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ actions/upload.ts          â”‚  â”‚ actions/recover.ts         â”‚             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚ uploadAndProcess()          â”‚  â”‚ recoverFile()              â”‚             â”‚
â”‚  â”‚                             â”‚  â”‚                            â”‚             â”‚
â”‚  â”‚ âœ… Auth check               â”‚  â”‚ âœ… Auth check              â”‚             â”‚
â”‚  â”‚ âœ… Rate limit               â”‚  â”‚ âœ… Rate limit              â”‚             â”‚
â”‚  â”‚ âœ… File validation          â”‚  â”‚ âœ… Extract stego data      â”‚             â”‚
â”‚  â”‚ âœ… Encrypt file             â”‚  â”‚ âœ… Blockchain verify       â”‚             â”‚
â”‚  â”‚ âœ… Embed in image           â”‚  â”‚ âœ… Integrity check         â”‚             â”‚
â”‚  â”‚ âœ… Hash computation         â”‚  â”‚ âœ… Decrypt file            â”‚             â”‚
â”‚  â”‚ âœ… Blockchain store         â”‚  â”‚ âœ… Tamper detection        â”‚             â”‚
â”‚  â”‚ âœ… DB metadata store        â”‚  â”‚ âœ… Audit logging           â”‚             â”‚
â”‚  â”‚ âœ… Audit logging            â”‚  â”‚                            â”‚             â”‚
â”‚  â”‚                             â”‚  â”‚ getUserFiles()             â”‚             â”‚
â”‚  â”‚ getUserFiles()              â”‚  â”‚ verifyBlockchainHash()     â”‚             â”‚
â”‚  â”‚ getUserActivityLogs()        â”‚  â”‚                            â”‚             â”‚
â”‚  â”‚ revokeFile()                â”‚  â”‚                            â”‚             â”‚
â”‚  â”‚                             â”‚  â”‚                            â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                               â”‚
â”‚  â””â”€ 'use server' directive ensures server-only execution                     â”‚
â”‚  â””â”€ Receives FormData from client                                            â”‚
â”‚  â””â”€ Returns JSON response to client                                          â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ lib/* (Core Libraries)        â”‚
                    â”‚ (Cryptography & Utilities)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SECURITY & UTILITIES LAYER                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ lib/crypto.ts   â”‚  â”‚ lib/stego.ts    â”‚  â”‚lib/blockchain.tsâ”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ âœ… AES-256-GCM  â”‚  â”‚ âœ… LSB Embed    â”‚  â”‚ âœ… Mock Service â”‚              â”‚
â”‚  â”‚ âœ… RSA-2048     â”‚  â”‚ âœ… LSB Extract  â”‚  â”‚ âœ… Hash Store   â”‚              â”‚
â”‚  â”‚ âœ… Key wrapping â”‚  â”‚ âœ… CRC Integrityâ”‚  â”‚ âœ… Verification â”‚              â”‚
â”‚  â”‚ âœ… Random IV    â”‚  â”‚ âœ… Sharp images â”‚  â”‚ âœ… (Phase 2:    â”‚              â”‚
â”‚  â”‚ âœ… Auth tag     â”‚  â”‚                 â”‚  â”‚    ethers.js)   â”‚              â”‚
â”‚  â”‚ âœ… Secure IDs   â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ lib/env.ts      â”‚  â”‚lib/rate-limit.tsâ”‚  â”‚ lib/audit.ts    â”‚              â”‚
â”‚  â”‚ [NEW - Phase 5a]â”‚  â”‚ [NEW - Phase 5b]â”‚  â”‚ [NEW - Phase 5d]â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ âœ… Validate     â”‚  â”‚ âœ… Upload limit â”‚  â”‚ âœ… Audit logger â”‚              â”‚
â”‚  â”‚    environment  â”‚  â”‚    5/min        â”‚  â”‚ âœ… Log activity â”‚              â”‚
â”‚  â”‚    variables    â”‚  â”‚ âœ… Recovery     â”‚  â”‚ âœ… Tamper flag  â”‚              â”‚
â”‚  â”‚ âœ… Check RSA    â”‚  â”‚    limit        â”‚  â”‚ âœ… Query logs   â”‚              â”‚
â”‚  â”‚    key format   â”‚  â”‚    10/min       â”‚  â”‚ âœ… Rate limit   â”‚              â”‚
â”‚  â”‚ âœ… Throw on     â”‚  â”‚ âœ… Per-user     â”‚  â”‚    detection    â”‚              â”‚
â”‚  â”‚    missing      â”‚  â”‚    tracking     â”‚  â”‚                 â”‚              â”‚
â”‚  â”‚ âœ… Safe getters â”‚  â”‚ âœ… Auto cleanup â”‚  â”‚ [Fail-safe]     â”‚              â”‚
â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚ lib/types.ts        â”‚  â”‚ lib/utils.ts     â”‚                             â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                             â”‚
â”‚  â”‚ âœ… TypeScript types â”‚  â”‚ âœ… CN utility    â”‚                             â”‚
â”‚  â”‚ âœ… Interfaces       â”‚  â”‚ âœ… Helpers       â”‚                             â”‚
â”‚  â”‚ âœ… Union types      â”‚  â”‚                  â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ lib/supabase/                  â”‚  â”‚ next.config.mjs      â”‚              â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ [MODIFIED - Phase 5c]â”‚              â”‚
â”‚  â”‚ server.ts   - Server client    â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
â”‚  â”‚ client.ts   - Browser client   â”‚  â”‚ âœ… CSP headers       â”‚              â”‚
â”‚  â”‚ middleware.ts - Auth refresh   â”‚  â”‚ âœ… HSTS              â”‚              â”‚
â”‚  â”‚                                â”‚  â”‚ âœ… X-Frame-Options   â”‚              â”‚
â”‚  â”‚ (Supabase Auth integration)    â”‚  â”‚ âœ… XSS Protection    â”‚              â”‚
â”‚  â”‚                                â”‚  â”‚ âœ… Permission Policy â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Database Queries (Supabase)   â”‚
                    â”‚ (RLS protected)               â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DATABASE LAYER (Supabase PostgreSQL)                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ profiles             â”‚  â”‚ metadata               â”‚  â”‚ activity_logs   â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ id (PK)              â”‚  â”‚ id (PK)                â”‚  â”‚ id (PK)         â”‚ â”‚
â”‚  â”‚ role                 â”‚  â”‚ user_id (FK)           â”‚  â”‚ user_id (FK)    â”‚ â”‚
â”‚  â”‚ display_name         â”‚  â”‚ original_filename      â”‚  â”‚ action          â”‚ â”‚
â”‚  â”‚ created_at           â”‚  â”‚ encryption_algo        â”‚  â”‚ resource_id     â”‚ â”‚
â”‚  â”‚ updated_at           â”‚  â”‚ iv                     â”‚  â”‚ details (JSON)  â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ auth_tag               â”‚  â”‚ ip_address      â”‚ â”‚
â”‚  â”‚ RLS: Visible to      â”‚  â”‚ encrypted_key          â”‚  â”‚ user_agent      â”‚ â”‚
â”‚  â”‚ current user only    â”‚  â”‚ blockchain_hash        â”‚  â”‚ created_at      â”‚ â”‚
â”‚  â”‚ (admin can see all)  â”‚  â”‚ blockchain_tx_id       â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ integrity_hash         â”‚  â”‚ RLS: User can   â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ status                 â”‚  â”‚ see own logs    â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ created_at             â”‚  â”‚ (admin can see  â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ updated_at             â”‚  â”‚  all)           â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚                        â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ RLS: User can only     â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚ see own files          â”‚  â”‚                 â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚                        â”‚  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                               â”‚
â”‚  All tables have Row-Level Security (RLS) policies                           â”‚
â”‚  Authenticated users only (via Supabase Auth)                                â”‚
â”‚  Admin users (role='ADMIN') have elevated access                             â”‚
â”‚                                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

## ğŸ”„ Data Encryption Pipeline

```
User File
    â”‚
    â”œâ”€ Read into Buffer
    â”‚
    â”œâ”€ Generate Random IV
    â”‚
    â””â”€ AES-256-GCM Encryption
           â”‚
           â”œâ”€ Encrypted Data (ciphertext)
           â”œâ”€ Auth Tag (for integrity)
           â”œâ”€ Random Session Key
           â”‚
           â””â”€ RSA-2048 Wrap Session Key
                  â”‚
                  â””â”€ Encrypted Key (wrapped)

Carrier Image
    â”‚
    â”œâ”€ Read into Buffer
    â”‚
    â”œâ”€ Convert to RGBA pixels (Sharp)
    â”‚
    â””â”€ LSB Steganographic Embedding
           â”‚
           â”œâ”€ Hide encrypted data
           â”œâ”€ Modify LSBs
           â”œâ”€ CRC integrity check
           â”‚
           â””â”€ Reconstruct image (Sharp)
                  â”‚
                  â””â”€ PNG (lossless compression)

SHA-256 Hash of Encrypted Data
    â”‚
    â””â”€ Store on Blockchain (mock)

Metadata Storage
    â”‚
    â”œâ”€ user_id
    â”œâ”€ filename
    â”œâ”€ iv (hex)
    â”œâ”€ auth_tag (hex)
    â”œâ”€ encrypted_key (base64)
    â”œâ”€ blockchain_hash
    â”œâ”€ blockchain_tx_id
    â””â”€ status = 'ACTIVE'

Output: Stego Image (PNG) + Metadata ID
```

## ğŸ”„ Data Recovery Pipeline

```
Stego Image + Metadata ID
    â”‚
    â”œâ”€ Verify User Authentication
    â”‚
    â”œâ”€ Check Rate Limit (10/min)
    â”‚
    â”œâ”€ Extract from Stego Image
    â”‚     â”‚
    â”‚     â”œâ”€ Read PNG to RGBA pixels
    â”‚     â”œâ”€ Extract LSB data
    â”‚     â””â”€ Verify CRC integrity
    â”‚
    â”œâ”€ Retrieve Encryption Parameters
    â”‚     â”‚
    â”‚     â”œâ”€ From database: iv, auth_tag, encrypted_key
    â”‚     â””â”€ Status check: must be 'ACTIVE'
    â”‚
    â”œâ”€ Verify Blockchain Hash
    â”‚     â”‚
    â”‚     â”œâ”€ Compute SHA-256 of extracted data
    â”‚     â””â”€ Compare with stored hash
    â”‚
    â”œâ”€ Decrypt with AES-256-GCM
    â”‚     â”‚
    â”‚     â”œâ”€ RSA-2048 unwrap session key
    â”‚     â”œâ”€ AES-256-GCM decrypt
    â”‚     â””â”€ Verify auth tag
    â”‚
    â”œâ”€ Integrity Check
    â”‚     â”‚
    â”‚     â””â”€ If hash mismatch â†’ TAMPERING DETECTED âš ï¸
    â”‚
    â”œâ”€ Log Recovery Activity
    â”‚     â”‚
    â”‚     â”œâ”€ Log to activity_logs
    â”‚     â””â”€ Flag tamper attempt if detected
    â”‚
    â””â”€ Output: Original File + Status Flags
         â”‚
         â”œâ”€ originalFilename
         â”œâ”€ mimeType
         â”œâ”€ fileBase64
         â”œâ”€ integrityVerified (boolean)
         â””â”€ blockchainVerified (boolean)
```

## ğŸ“Š Security Event Tracking

```
User Action
    â”‚
    â”œâ”€ UPLOAD
    â”‚  â”œâ”€ stego_seed
    â”‚  â”œâ”€ file_size
    â”‚  â”œâ”€ capacity_used
    â”‚  â””â”€ capacity_total
    â”‚
    â”œâ”€ RECOVERY
    â”‚  â”œâ”€ success (boolean)
    â”‚  â”œâ”€ integrity_verified
    â”‚  â”œâ”€ blockchain_verified
    â”‚  â””â”€ data_length
    â”‚
    â”œâ”€ REVOKE
    â”‚  â””â”€ revoked_at (timestamp)
    â”‚
    â”œâ”€ TAMPER_DETECTED âš ï¸
    â”‚  â”œâ”€ severity: 'HIGH'
    â”‚  â””â”€ reason (hash mismatch, etc.)
    â”‚
    â”œâ”€ RATE_LIMIT_EXCEEDED âš ï¸
    â”‚  â””â”€ triggered_by_action
    â”‚
    â”œâ”€ HASH_VERIFY
    â”‚  â”œâ”€ verified (boolean)
    â”‚  â””â”€ txId
    â”‚
    â””â”€ ADMIN_ACCESS
       â””â”€ operation (what admin did)

    â”‚
    â””â”€ Logged to activity_logs table
         â”‚
         â”œâ”€ user_id
         â”œâ”€ action
         â”œâ”€ resource_id
         â”œâ”€ details (JSON)
         â”œâ”€ ip_address (optional)
         â”œâ”€ user_agent (optional)
         â””â”€ created_at (auto timestamp)
         
    â”‚
    â””â”€ Admin Dashboard Display
         â”‚
         â”œâ”€ Real-time activity feed
         â”œâ”€ Tamper alerts (red highlighting)
         â”œâ”€ Rate limit tracking
         â””â”€ Suspicious activity flagging
```

## ğŸ” Security Layers

```
Layer 1: Authentication
â”œâ”€ Supabase Auth (Firebase-like)
â”œâ”€ Session tokens in secure cookies
â””â”€ Per-request user verification

Layer 2: Authorization
â”œâ”€ RBAC (Role-Based Access Control)
â”‚  â”œâ”€ USER role (default)
â”‚  â””â”€ ADMIN role (monitoring panel)
â”œâ”€ RLS (Row-Level Security)
â”‚  â”œâ”€ Users see only their own files
â”‚  â””â”€ Admins see all files
â””â”€ Resource ownership checks

Layer 3: Encryption
â”œâ”€ At-rest: AES-256-GCM (symmetric)
â”œâ”€ Key protection: RSA-2048 (asymmetric)
â”œâ”€ Integrity: SHA-256 + GCM auth tag
â””â”€ Transport: HTTPS + Secure headers

Layer 4: Steganography
â”œâ”€ LSB embedding in carrier images
â”œâ”€ CRC integrity checks
â””â”€ Capacity validation

Layer 5: Rate Limiting
â”œâ”€ Per-user request throttling
â”œâ”€ 5 uploads/min, 10 recoveries/min
â””â”€ Automatic cleanup of old entries

Layer 6: Audit Logging
â”œâ”€ Every action tracked
â”œâ”€ Tamper detection flagging
â”œâ”€ Admin monitoring dashboard
â””â”€ Activity export capability

Layer 7: Security Headers
â”œâ”€ Content-Security-Policy
â”œâ”€ X-Frame-Options: DENY
â”œâ”€ HSTS (1 year)
â”œâ”€ Referrer-Policy
â””â”€ Permissions-Policy

Layer 8: Environment Validation
â”œâ”€ Required env vars check
â”œâ”€ RSA key format validation
â”œâ”€ Fails early on missing secrets
â””â”€ Type-safe getters
```

---

This architecture ensures **defense in depth** with multiple security layers protecting user data at every stage of encryption, storage, and recovery.
